
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="abcjs_basic_2.3-min.js" type="text/javascript"></script>
	<script src="parser.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
	
</head>
<body>


	<script type="text/javascript">

	var MEASURE_LENGTH_PADDING = 2;

	var timeNumerator = 4;
	var timeDenominator = 4;
	var minMeasures = 0;
	var maxMeasures = 0;
    var lineLength = 25;
	var startKey = 'C';
	var noteLengths = ['q'];
	var noteLetters = ['C,', 'D,', 'E,', 'F,', 'G,', 'A,', 'B,', 'C', 'D', 'E', 'F', 'G', 'A', 'B', 'c', 'd', 'e', 'f', 'g', 'a', 'b'];
    //var keys = ['A','B','C','D','E','F','G'];


	function randInt(bound) {
		return Math.floor(Math.random() * (bound));
	}

    function test(){

        var params = [{ foo: true }, { bar: false }];
        var paramList = {};
        
        for (var i = 0; i < params.length; i++) {
            console.log(params[i]);
            for (var key in params[i]) {
                console.log(key);
                console.log(params[i][key]);
                paramList[key] = params[i][key];
                
             }
        }
        paramList["hlasd"] = "hi";
        console.log(paramList);
    }

    //generates and renders piece based on current parameters
    function generate(){
        test();
    	parse();
    	var genString ="M: " + timeNumerator + "/" + timeDenominator + "\n";
    	genString = genString + "L: 1/4 \n"
    	genString = genString + "K: " + startKey + "\n"

    	var m = randInt(maxMeasures - minMeasures + 1) + minMeasures;
    	var curLineLength = 0; //current number of notes in line (to keep track of when to start new line)
    	while (m > 0){
    		var measure = genMeasure();
    		m--;
    		genString = genString + measure.measureString;
    		curLineLength += measure.numNotes;

    		//start new line if we're past lineLength
    		if (curLineLength >= lineLength){
    			curLineLength = 0;
    			genString = genString + "\n";
    		}
    	}

        //alert(genString);
    	ABCJS.renderAbc('notation', genString);
    }

    //parses whatever's in the #input text area with parser.parse().  sets appropriate parameters based on data received from parsing.
    function parse(){
    	var data = parser.parse($('textarea#input').val());
    	
    	//number of measures.  either array (when user enters a min/max range) or an int.
        if (data.numMeasures != null){
            if (data.numMeasures.constructor === Array){
    	      minMeasures = data.numMeasures[0];
               maxMeasures = data.numMeasures[1];
            }
            else {
                minMeasures = data.numMeasures;
                maxMeasures = data.numMeasures;
            }
        }

        //starting key
        startKey = data.key;
    }

    //returns an object that wraps two elements: measureString, numNotes
    function genMeasure(){

    	var measureString = "";
    	var n = 4;
    	var numNotes = 0;
    	while (n > 0){
    		n--;
    		measureString = measureString + " " + noteLetters[randInt(noteLetters.length)];
    		numNotes++;  //increment numNotes every time we add a note.
    	}
    	measureString = measureString + " |";
    	numNotes += MEASURE_LENGTH_PADDING;
    	return {
    		measureString: measureString, 
    		numNotes: numNotes
    	};
    }
    </script>

    <p>
    	<a href="#" onclick="generate()" >GENERATE</a>
    </p>

    <textarea id="input">measures: 10</textarea>

    <div id="notation"></div>

</body>
</html>